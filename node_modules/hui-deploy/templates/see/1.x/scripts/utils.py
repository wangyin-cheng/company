import json
import os
import re
import sys


def clear(name, type):
    conf = os.path.join(os.path.abspath(os.path.dirname(sys.argv[0])), "conf")

    manifest = ""

    for file in os.listdir(conf):
        if(re.match(r'manifest\.[0-9]+\.json', file)):
            manifest = file

    if(manifest == ""):
        os.popen("rm -rf ./" + name)
    else:
        file = open(os.path.join(conf, manifest), "rb")
        fileJson = json.load(file)

        dirs = []

        prefix = ""

        if(type == "bizframe"):
            prefix = "./" + name + "/"
        elif(type == "subsystem"):
            prefix = "./"

        for x in fileJson:
            if fileJson[x]["dir"] not in dirs:
                dirs.append(fileJson[x]["dir"])

            if(os.path.exists(prefix + fileJson[x]["path"])):
                os.remove(prefix + fileJson[x]["path"])

        for x in dirs:
            if(type == "bizframe" and x != "" or type == "subsystem" and x != name):
                if(os.path.exists(prefix + x)):
                    try:
                        os.removedirs(prefix + x)
                    except OSError:
                        pass
